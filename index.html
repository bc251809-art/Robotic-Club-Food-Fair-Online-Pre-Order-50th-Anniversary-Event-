<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UPM Robotic Club Food Fair Online Pre-Order</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: system-ui, sans-serif; max-width: 900px; margin: 0 auto; padding: 16px; background: #f9f5ef; }
        h1, h2, h3 { text-align: center; }
        h1 { margin-top: 12px; margin-bottom: 4px; }
        .subtitle { text-align: center; font-size: 14px; margin-bottom: 16px; }
        .event-info { background: #fff; border-radius: 12px; padding: 12px 16px; margin-bottom: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.04); font-size: 14px; }
        .event-info ul { padding-left: 18px; margin: 4px 0; }
        .poster-grid { display: grid; grid-template-columns: minmax(0,1fr); gap: 12px; margin-bottom: 20px; }
        .poster-grid img { width: 100%; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        @media (min-width: 768px){ .poster-grid { grid-template-columns: repeat(3,1fr);} }
        .section { background:#fff; border-radius:12px; padding:16px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.04); }
        .form-row { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; }
        .form-group { flex:1 1 160px; }
        label { display:block; font-size:13px; margin-bottom:4px; }
        input,select,textarea { width:100%; padding:6px 8px; border-radius:6px; border:1px solid #ddd; font-size:14px; }
        textarea { resize:vertical; }
        .menu-table { width:100%; border-collapse:collapse; font-size:14px; }
        .menu-table td { border-bottom:1px solid #f0e3d0; padding:6px 4px; }
        .menu-name { font-weight:600; }
        .price-cell { white-space:nowrap; font-weight:500; }
        .qty-input { width:60px; }
        .note { font-size:12px; color:#666; margin-top:4px; }
        .total { text-align:right; font-size:18px; font-weight:600; margin-top:16px; }
        .submit-btn { width:100%; padding:10px; border:none; border-radius:999px; background:#25d366; color:#fff; font-size:16px; margin-top:14px; }
        .footer { text-align:center; font-size:11px; color:#777; margin-top:12px; }
    </style>
</head>
<body>

<h1>Robotic Club Food Fair</h1>
<div class="subtitle">Online Pre-Order Â· Free Delivery to All Kolej ðŸŽ‰</div>

<div class="event-info">
    <strong>Event Details</strong>
    <ul>
        <li><b>Date:</b> 17â€“20 Dec 2025</li>
        <li><b>Time:</b> 8:00am â€“ 5:00pm</li>
        <li><b>Venue:</b> Faculty of Engineering, UPM</li>
        <li><b>Delivery:</b> Free delivery to all Kolej</li>
    </ul>
</div>

<div class="section">
    <h3>Customer Details</h3>
    <div class="form-row">
        <div class="form-group">
            <label>Name</label>
            <input id="name" type="text" required>
        </div>
        <div class="form-group">
            <label>WhatsApp Number</label>
            <input id="whatsapp" type="tel" required>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Kolej / Block</label>
            <select id="kolej-block">
                <option value="">Please select</option>
                <option>K10</option><option>Library</option><option>KC</option>
                <option>KTDI</option><option>KOSASS</option><option>KPZ</option>
                <option>K12</option><option>K13</option><option>K14</option>
                <option>FPV</option><option>K17 (1)</option><option>K17 (2)</option>
            </select>
        </div>

        <div class="form-group">
            <label>Delivery Date</label>
            <select id="delivery-date">
                <option value="">Please select</option>
                <option>17/12/25</option><option>18/12/25</option>
                <option>19/12/25</option><option>20/12/25</option>
            </select>
        </div>

        <div class="form-group">
            <label>Preferred Time Slot</label>
            <select id="timeSlot">
                <option value="">Please select</option>
                <option>12:00â€“1:00pm</option><option>5:00â€“6:00pm</option>
            </select>
        </div>
    </div>
</div>

<div class="section">
    <h3>Order Items</h3>

    <!-- PUDDING -->
    <div class="category">Pudding Cup</div>
    <p class="note">1 for RM3 Â· 3 for RM8</p>

    <table class="menu-table">
        <tbody>
            <tr><td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-group="dessert" data-name="Mango Cup"> Mango Cup</label></td><td class="price-cell">RM 3.00</td><td><input type="number" class="qty-input item-qty" value="1"></td></tr>
            <tr><td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-group="dessert" data-name="Chocolate Cup"> Chocolate Cup</label></td><td class="price-cell">RM 3.00</td><td><input type="number" class="qty-input item-qty" value="1"></td></tr>
            <tr><td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-group="dessert" data-name="Grape Cup"> Grape Cup</label></td><td class="price-cell">RM 3.00</td><td><input type="number" class="qty-input item-qty" value="1"></td></tr>
        </tbody>
    </table>

    <!-- COCONUT -->
    <div class="category">Coconut Jelly</div>
    <p class="note">1 for RM5 Â· 2 for RM8</p>
    <table class="menu-table">
        <tr><td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-group="coconut" data-name="Coconut Jelly"> Coconut Jelly</label></td><td class="price-cell">RM 5.00</td><td><input class="qty-input item-qty" type="number" value="1"></td></tr>
    </table>

    <!-- TAUFUFA -->
    <div class="category">Tau Fu Fa</div>
    <p class="note">Original RM4 Â· Fruit+2 toppings RM6.90 Â· All-in RM9.90</p>

    <table class="menu-table">
        <tr>
            <td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="4" data-name="Taufufa Original"> Taufufa Original</label></td>
            <td class="price-cell">RM 4.00</td>
            <td><input class="qty-input item-qty" value="1" type="number"></td>
        </tr>

        <tr>
            <td class="menu-name">
                <label><input type="checkbox" class="item-checkbox taufufa-fruit2" data-price="6.9" data-name="Taufufa (Fruit + 2 toppings)"> Taufufa (Fruit + 2 toppings)</label>

                <div style="margin-left:20px;">
                    <strong>Fruit (choose 1):</strong><br>
                    <label><input type="radio" name="taufufa-fruit" value="Watermelon"> Watermelon</label><br>
                    <label><input type="radio" name="taufufa-fruit" value="Mango"> Mango</label>
                </div>

                <div style="margin-left:20px; margin-top:8px;">
                    <strong>Toppings (choose 2):</strong><br>
                    <label><input type="checkbox" class="topping" value="Boba"> Boba</label><br>
                    <label><input type="checkbox" class="topping" value="Grass Jelly"> Grass Jelly</label><br>
                    <label><input type="checkbox" class="topping" value="Popping Boba"> Popping Boba</label><br>
                    <label><input type="checkbox" class="topping" value="Oreo"> Oreo</label>
                </div>
            </td>
            <td class="price-cell">RM 6.90</td>
            <td><input type="number" value="1" class="qty-input item-qty"></td>
        </tr>

        <tr>
            <td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="9.9" data-name="Taufufa All In"> Taufufa All In</label></td>
            <td class="price-cell">RM 9.90</td>
            <td><input value="1" class="qty-input item-qty" type="number"></td>
        </tr>
    </table>

    <!-- Stick & Bite -->
    <div class="category">Stick & Bite Menu</div>
    <table class="menu-table">
        <tr><td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="3" data-name="Milky Cheese Stick"> Milky Cheese Stick</label></td><td class="price-cell">RM 3.00</td><td><input value="1" class="qty-input item-qty"></td></tr>
        <tr><td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="3" data-name="Fruit Stick"> Fruit Stick</label></td><td class="price-cell">RM 3.00</td><td><input value="1" class="qty-input item-qty"></td></tr>
        <tr><td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="5" data-name="Spiral Potato"> Spiral Potato</label></td><td class="price-cell">RM 5.00</td><td><input value="1" class="qty-input item-qty"></td></tr>
    </table>

    <!-- Drinks -->
    <div class="category">Drinks</div>
    <table class="menu-table">
        <tr><td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="7" data-name="Melon Breeze"> Melon Breeze</label></td><td class="price-cell">RM 7.00</td><td><input class="qty-input item-qty" value="1"></td></tr>
        <tr><td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="7" data-name="Twilight Sparkle"> Twilight Sparkle</label></td><td class="price-cell">RM 7.00</td><td><input class="qty-input item-qty" value="1"></td></tr>
    </table>

    <label>Remarks</label>
    <textarea id="remark" rows="3"></textarea>

    <div class="total">Total: RM <span id="totalPrice">0.00</span></div>

    <button id="submitBtn" class="submit-btn" disabled>Submit Order (TNG)</button>
</div>

<script>
// Your Google Apps Script API URL
const STATS_API = "https://script.google.com/a/macros/student.upm.edu.my/s/AKfycbxu-ol4Os5qrQI3qAi9ykrugjG9qJW9LpIMqd_bwMzYeuK7m8wJFpVKjjtGHsohGGW2/exec";

document.addEventListener("DOMContentLoaded", function(){
    const checkboxes = document.querySelectorAll(".item-checkbox");
    const qtyInputs = document.querySelectorAll(".item-qty");
    const toppingCheckboxes = document.querySelectorAll(".topping");
    const fruitRadios = document.querySelectorAll("input[name='taufufa-fruit']");
    const fruit2 = document.querySelector(".taufufa-fruit2");
    const totalPriceSpan = document.getElementById("totalPrice");

    function enableTaufufaFields(enabled) {
        fruitRadios.forEach(r => r.disabled = !enabled);
        toppingCheckboxes.forEach(t => t.disabled = !enabled);
    }

    enableTaufufaFields(false);

    fruit2.addEventListener("change", () => {
        const on = fruit2.checked;
        enableTaufufaFields(on);
        if (!on) {
            fruitRadios.forEach(r => r.checked = false);
            toppingCheckboxes.forEach(t => t.checked = false);
        }
        updateTotal();
    });

    toppingCheckboxes.forEach(box => {
        box.addEventListener("change", () => {
            const selected = Array.from(toppingCheckboxes).filter(b => b.checked);
            if (selected.length > 2) {
                alert("Only 2 toppings allowed.");
                box.checked = false;
            }
        });
    });

    function computeOrder() {
        let total = 0;
        let hasItem = false;

        let dessertQty = 0;
        let dessertList = [];

        let coconutQty = 0;

        let lines = [];

        checkboxes.forEach((cb, i) => {
            if (!cb.checked) return;

            hasItem = true;

            const row = cb.closest("tr");
            const qty = Number(row.querySelector(".item-qty").value);
            const name = cb.dataset.name;
            const group = cb.dataset.group;
            const price = Number(cb.dataset.price || 0);

            if (group === "dessert") {
                dessertQty += qty;
                dessertList.push(${name} x ${qty});
            }
            else if (group === "coconut") {
                coconutQty += qty;
            }
            else {
                let extra = "";

                if (name === "Taufufa (Fruit + 2 toppings)") {
                    const fruit = Array.from(fruitRadios).find(r => r.checked)?.value || "-";
                    const toppings = Array.from(toppingCheckboxes).filter(t => t.checked).map(t => t.value);
                    extra = ` (Fruit: ${fruit}; Toppings: ${toppings.join(", ") || "-"})`;
                }

                total += price * qty;
                lines.push(${name}${extra} x ${qty} : RM ${(price * qty).toFixed(2)});
            }
        });

        if (dessertQty > 0) {
            const bundles = Math.floor(dessertQty / 3);
            const remainder = dessertQty % 3;
            const dessertTotal = bundles * 8 + remainder * 3;
            total += dessertTotal;
            lines.push(Pudding Cups - ${dessertQty} cups [${dessertList.join(", ")}] : RM ${dessertTotal.toFixed(2)});
        }

        if (coconutQty > 0) {
            const bundles = Math.floor(coconutQty / 2);
            const remainder = coconutQty % 2;
            const coconutTotal = bundles * 8 + remainder * 5;
            total += coconutTotal;
            lines.push(Coconut Jelly - ${coconutQty} cups : RM ${coconutTotal.toFixed(2)});
        }

        return { total, hasItem, lines };
    }

    function updateTotal() {
        const result = computeOrder();
        totalPriceSpan.textContent = result.total.toFixed(2);
        document.getElementById("submitBtn").disabled = !result.hasItem;
    }

    checkboxes.forEach(c => c.addEventListener("change", updateTotal));
    qtyInputs.forEach(q => q.addEventListener("input", updateTotal));

    document.getElementById("submitBtn").addEventListener("click", () => {
        const result = computeOrder();

        const name = document.getElementById("name").value.trim();
        const whatsapp = document.getElementById("whatsapp").value.trim();
        const kolej = document.getElementById("kolej-block").value.trim();
        const date = document.getElementById("delivery-date").value.trim();
        const timeSlot = document.getElementById("timeSlot").value.trim();
        const remark = document.getElementById("remark").value.trim();

        if (!name || !whatsapp || !kolej || !date || !timeSlot) {
            alert("Please fill all required fields.");
            return;
        }

        const message = 
            Order Summary\n\n +
            Name: ${name}\n +
            WhatsApp: ${whatsapp}\n +
            Kolej: ${kolej}\n +
            Delivery: ${date}\n +
            Time Slot: ${timeSlot}\n\n +
            Items:\n${result.lines.join("\n")}\n\n +
            Total: RM ${result.total.toFixed(2)}\n +
            Remarks: ${remark || "-"};

        if (!confirm(message + "\n\nConfirm order?")) return;

        // SEND ORDER TO GOOGLE SHEET
        fetch(STATS_API, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                name: name,
                whatsapp: whatsapp,
                kolejBlock: kolej,
                deliveryDate: date,
                timeSlot: timeSlot,
                remark: remark,
                total: result.total,
                orderText: result.lines.join("\n")
            })
        });

        // OPEN TNG PAGE
        window.open("tng-qrcode.html?total=" + result.total.toFixed(2), "_blank");
    });
});
</script>

</body>
</html>
