<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UPM Robotic Club Food Fair Online Pre-Order</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 16px;
            background: #f9f5ef;
        }

        h1, h2, h3 {
            text-align: center;
        }

        h1 { margin-top: 12px; margin-bottom: 4px; }

        .subtitle { text-align: center; font-size: 14px; margin-bottom: 16px; }

        .event-info {
            background: #fff;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
            font-size: 14px;
        }

        .event-info ul { padding-left: 18px; margin: 4px 0; }

        .poster-grid {
            display: grid;
            grid-template-columns: minmax(0,1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .poster-grid img {
            width: 100%;
            border-radius: 10px;
            display: block;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        @media (min-width: 768px) {
            .poster-grid { grid-template-columns: repeat(3, minmax(0,1fr)); }
        }

        .section {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .form-group { flex: 1 1 160px; min-width: 0; }

        label { display: block; font-size: 13px; margin-bottom: 4px; }

        input[type="text"], input[type="tel"], input[type="date"], select, textarea {
            width: 100%;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 14px;
            box-sizing: border-box;
        }

        textarea { resize: vertical; }

        .menu-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .menu-table th, .menu-table td {
            border-bottom: 1px solid #f0e3d0;
            padding: 6px 4px;
        }

        .menu-table th { text-align: left; background: #fdf4e5; }

        .menu-name { font-weight: 600; }

        .price-cell { white-space: nowrap; font-weight: 500; }

        .qty-input { width: 60px; }

        .note { font-size: 12px; color: #666; margin-top: 4px; }

        .total {
            text-align: right;
            font-size: 18px;
            font-weight: 600;
            margin-top: 16px;
        }

        .submit-btn {
            display: block;
            width: 100%;
            padding: 10px 0;
            margin-top: 14px;
            border: none;
            border-radius: 999px;
            font-size: 16px;
            cursor: pointer;
            background: #25d366;
            color: #fff;
        }

        .submit-btn:disabled { background: #ddd; cursor: not-allowed; }

        .footer {
            text-align: center;
            font-size: 11px;
            color: #777;
            margin-top: 12px;
        }

        .category { margin-top: 10px; margin-bottom: 4px; font-weight: 600; }

        .top-logo {
            max-width: 900px;
            margin: 0 auto 12px;
        }

        .top-logo img { display: block; width: 100%; height: auto; }

        .footer-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .footer-logos img {
            max-width: 120px;
            height: auto;
        }

        .stats-link {
            text-align: center;
            font-size: 13px;
            margin-top: 10px;
        }

        .stats-link a {
            color: #0066cc;
            text-decoration: none;
        }

        .stats-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>

    <!-- Top Logo -->
    <div class="top-logo">
        <img src="logo.jpg" alt="Robotic Club Logo">
    </div>

    <h1>Robotic Club Food Fair</h1>
    <div class="subtitle">
        Online Pre-Order Â· Engineering Faculty 50th Anniversary Â· Free Delivery to All Kolej ðŸŽ‰
    </div>

    <div class="event-info">
        <strong>Event Details</strong>
        <ul>
            <li><b>Date:</b> 17â€“20 Dec 2025</li>
            <li><b>Time:</b> 8:00am â€“ 5:00pm</li>
            <li><b>Venue:</b> Faculty of Engineering, UPM</li>
            <li><b>Delivery:</b> Free delivery to all Kolej</li>
        </ul>
        <div class="note">
            Please place your order before 10:00pm on the day before delivery.
            Actual delivery schedule will be confirmed by the Robotic Club committee.
        </div>
    </div>

    <!-- Delivery Location Section -->
    <div class="section">
        <h2>Delivery Location</h2>
        <div class="poster-grid">
            <img src="location.jpg" alt="Delivery Location">
        </div>
    </div>

    <!-- Menu Posters -->
    <div class="section">
        <h2>Menu Posters</h2>
        <div class="poster-grid">
            <img src="menu-dessert.png.jpg" alt="Dessert Menu">
            <img src="menu-stick.png.jpg" alt="Stick Menu">
            <img src="menu-drink.png.jpg" alt="Drinks Menu">
        </div>
    </div>
    <div class="section">
        <h2>Online Pre-Order Form</h2>

        <h3>Customer Details</h3>

        <div class="form-row">
            <div class="form-group">
                <label>Name</label>
                <input id="name" type="text" required>
            </div>
            <div class="form-group">
                <label>WhatsApp Number</label>
                <input id="whatsapp" type="tel" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Kolej / Block</label>
                <select id="kolej-block" required>
                    <option value="">Please select</option>
                    <option value="K10">K10</option>
                    <option value="Library">Library</option>
                    <option value="KC">KC</option>
                    <option value="KTDI">KTDI</option>
                    <option value="KOSASS">KOSASS</option>
                    <option value="KPZ">KPZ</option>
                    <option value="K12">K12</option>
                    <option value="K13">K13</option>
                    <option value="K14">K14</option>
                    <option value="FPV">FPV</option>
                    <option value="K17 (1)">K17 (1)</option>
                    <option value="K17 (2)">K17 (2)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Delivery Date</label>
                <select id="delivery-date" required>
                    <option value="">Please select</option>
                    <option value="17/12/25">17/12/25</option>
                    <option value="18/12/25">18/12/25</option>
                    <option value="19/12/25">19/12/25</option>
                    <option value="20/12/25">20/12/25</option>
                </select>
            </div>

            <div class="form-group">
                <label>Preferred Time Slot</label>
                <select id="timeSlot" required>
                    <option value="">Please select</option>
                    <option value="12:00â€“1:00pm">12:00â€“1:00pm</option>
                    <option value="5:00â€“6:00pm">5:00â€“6:00pm</option>
                </select>
            </div>
        </div>

        <!-- Order Items -->
        <h3>Order Items</h3>

        <!-- Pudding -->
        <div class="category">Pudding Cup</div>
        <p class="note">1 for RM3 Â· 3 for RM8 (mix & match allowed)</p >

        <table class="menu-table">
            <tbody>
                <tr>
                    <td class="menu-name">
                        <label><input type="checkbox" class="item-checkbox" data-group="dessert" data-name="Mango Cup"> Mango Cup</label>
                    </td>
                    <td class="price-cell">RM 3.00</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>
                <tr>
                    <td class="menu-name">
                        <label><input type="checkbox" class="item-checkbox" data-group="dessert" data-name="Chocolate Cup"> Chocolate Cup</label>
                    </td>
                    <td class="price-cell">RM 3.00</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>
                <tr>
                    <td class="menu-name">
                        <label><input type="checkbox" class="item-checkbox" data-group="dessert" data-name="Grape Cup"> Grape Cup</label>
                    </td>
                    <td class="price-cell">RM 3.00</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>
            </tbody>
        </table>

        <!-- Coconut -->
        <div class="category">Coconut Jelly</div>
        <p class="note">1 for RM5 Â· 2 for RM8</p >
        <table class="menu-table">
            <tbody>
                <tr>
                    <td class="menu-name">
                        <label><input type="checkbox" class="item-checkbox" data-group="coconut" data-name="Coconut Jelly"> Coconut Jelly</label>
                    </td>
                    <td class="price-cell">RM 5.00</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>
            </tbody>
        </table>

        <!-- Tau Fu Fa -->
        <div class="category">Tau Fu Fa</div>
        <p class="note">Original RM4 Â· Fruit+2 toppings RM6.90 Â· All-in RM9.90</p >

        <table class="menu-table">
            <tbody>

               <!-- Original -->
<tr>
  <td class="menu-name">
    <label>
      <input id="tofOriginal" type="checkbox" class="item-checkbox" data-price="4" data-name="Taufufa Original">
      Taufufa Original
    </label>

    <!-- Original Add-ons -->
    <div class="taufufa-original-options" style="margin-left:20px; margin-top:8px;">
      <div class="note">Add-ons (optional). Select Taufufa Original to enable.</div>

      <strong>Toppings (+RM1.00 each)</strong><br>

      <label><input type="checkbox" class="tof-addon" data-name="Boba" data-price="1"> Boba</label>
      Qty: <input type="number" class="tof-addon-qty" data-name="Boba" value="1" min="1" style="width:55px;"><br>

      <label><input type="checkbox" class="tof-addon" data-name="Grass Jelly" data-price="1"> Grass Jelly</label>
      Qty: <input type="number" class="tof-addon-qty" data-name="Grass Jelly" value="1" min="1" style="width:55px;"><br>

      <label><input type="checkbox" class="tof-addon" data-name="Popping Boba" data-price="1"> Popping Boba</label>
      Qty: <input type="number" class="tof-addon-qty" data-name="Popping Boba" value="1" min="1" style="width:55px;"><br>

      <label><input type="checkbox" class="tof-addon" data-name="Oreo" data-price="1"> Oreo</label>
      Qty: <input type="number" class="tof-addon-qty" data-name="Oreo" value="1" min="1" style="width:55px;"><br><br>

      <strong>Fruits (+RM1.50 each)</strong><br>

      <label><input type="checkbox" class="tof-addon" data-name="Watermelon" data-price="1.5"> Watermelon</label>
      Qty: <input type="number" class="tof-addon-qty" data-name="Watermelon" value="1" min="1" style="width:55px;"><br>

      <label><input type="checkbox" class="tof-addon" data-name="Mango" data-price="1.5"> Mango</label>
      Qty: <input type="number" class="tof-addon-qty" data-name="Mango" value="1" min="1" style="width:55px;">
    </div>
  </td>

  <td class="price-cell">RM 4.00</td>
  <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
</tr>

                <!-- Fruit + 2 toppings -->
                <tr>
                    <td class="menu-name">
                        <label>
                            <input type="checkbox" class="item-checkbox taufufa-fruit2" data-price="6.9" data-name="Taufufa (Fruit + 2 toppings)">
                            Taufufa (Fruit + 2 toppings)
                        </label>

                        <div style="margin-left:20px; margin-top:6px;">
                            <strong>Fruit (choose 1):</strong><br>
                            <label><input type="radio" name="taufufa-fruit" value="Watermelon"> Watermelon</label><br>
                            <label><input type="radio" name="taufufa-fruit" value="Mango"> Mango</label>
                        </div>

                        <div style="margin-left:20px; margin-top:8px;">
                            <strong>Toppings (choose 2):</strong><br>
                            <label><input type="checkbox" class="topping" value="Boba"> Boba</label><br>
                            <label><input type="checkbox" class="topping" value="Grass Jelly"> Grass Jelly</label><br>
                            <label><input type="checkbox" class="topping" value="Popping Boba"> Popping Boba</label><br>
                            <label><input type="checkbox" class="topping" value="Oreo"> Oreo</label>
                        </div>

                        <div class="note" style="margin-left:20px;">
                            Please select 1 fruit and 2 toppings.
                        </div>
                    </td>

                    <td class="price-cell">RM 6.90</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>

                <!-- All In -->
                <tr>
                    <td class="menu-name">
                        <label><input type="checkbox" class="item-checkbox" data-price="9.9" data-name="Taufufa All In"> Taufufa All In</label>
                        <div class="note">Much bigger! All toppings included.</div>
                    </td>
                    <td class="price-cell">RM 9.90</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>

            </tbody>
        </table>

        <!-- Sticks -->
        <div class="category">Stick & Bite Menu</div>
        <table class="menu-table">
            <tbody>
                <tr>
                    <td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="3" data-name="Milky Cheese Stick"> Milky Cheese Stick</label></td>
                    <td class="price-cell">RM 3.00</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>

                <tr>
                    <td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="3" data-name="Fruit Stick"> Fruit Stick</label></td>
                    <td class="price-cell">RM 3.00</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>

                <tr>
                    <td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="5" data-name="Spiral Potato"> Spiral Potato</label></td>
                    <td class="price-cell">RM 5.00</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>
            </tbody>
        </table>

        <!-- Drinks -->
        <div class="category">Putra Bites Drinks</div>
        <table class="menu-table">
            <tbody>
                <tr>
                    <td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="7" data-name="Melon Breeze"> Melon Breeze</label></td>
                    <td class="price-cell">RM 7.00</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>
                <tr>
                    <td class="menu-name"><label><input type="checkbox" class="item-checkbox" data-price="7" data-name="Twilight Sparkle"> Twilight Sparkle</label></td>
                    <td class="price-cell">RM 7.00</td>
                    <td><input type="number" class="qty-input item-qty" value="1" min="1"></td>
                </tr>
            </tbody>
        </table>

        <!-- Remarks -->
        <div class="form-row">
            <div class="form-group" style="flex-basis: 100%;">
                <label>Remarks</label>
                <textarea id="remark" rows="3"></textarea>
            </div>
        </div>

        <div class="total">
            Total: RM <span id="totalPrice">0.00</span>
        </div>

        <button id="submitBtn" class="submit-btn" disabled>
            Submit Order (TNG)
        </button>

        <div class="stats-link">
            View website statistics: <a href=" ">Open stats page</a >
        </div>
    </div>

    <!-- Footer Logos -->
    <div class="footer-logos">
        <img src="upm.jpg" alt="UPM logo">
        <img src="jubli50.jpg" alt="50th anniversary logo">
        <img src="robotic-footer.jpg" alt="Robotic Club logo">
    </div>

    <div class="footer">
        UPM Robotic Club Â· Engineering Faculty 50th Anniversary Â· With Knowledge We Serve
    </div>
    <script>
document.addEventListener('DOMContentLoaded', function () {
  // ====== Basic selectors ======
  const checkboxes = document.querySelectorAll('.item-checkbox');
  const qtyInputs = document.querySelectorAll('.item-qty');

  const toppingCheckboxes = document.querySelectorAll('.topping');
  const fruitRadios = document.querySelectorAll('input[name="taufufa-fruit"]');
  const fruit2 = document.querySelector('.taufufa-fruit2');

  const totalPriceSpan = document.getElementById('totalPrice');
  const submitBtn = document.getElementById('submitBtn');

  // Taufufa Original + add-ons
  const tofOriginal = document.getElementById('tofOriginal');
  const tofAddons = document.querySelectorAll('.tof-addon');
  const tofAddonQtyInputs = document.querySelectorAll('.tof-addon-qty');

  // ðŸ”¥ Your Google Sheet API URL
  const SHEET_API =
    "https://script.google.com/macros/s/AKfycbz3FSrwMNP3RoHBmkXwKXB_rVtRIOZBfv6Y20_GRNINXwjBNpP4SIKwtRS0P-ks86TL/exec";

  // ------------------------------
  // Enable / disable Fruit+2 toppings fields
  // ------------------------------
  function enableTaufufaFields(enabled) {
    fruitRadios.forEach(r => (r.disabled = !enabled));
    toppingCheckboxes.forEach(t => (t.disabled = !enabled));
  }

  enableTaufufaFields(false);

  if (fruit2) {
    fruit2.addEventListener('change', () => {
      const active = fruit2.checked;
      enableTaufufaFields(active);

      if (!active) {
        fruitRadios.forEach(r => (r.checked = false));
        toppingCheckboxes.forEach(t => (t.checked = false));
      }
      updateTotal();
    });
  }

  // Limit toppings to 2 (for Fruit+2 toppings)
  toppingCheckboxes.forEach(box => {
    box.addEventListener('change', () => {
      const selected = Array.from(toppingCheckboxes).filter(b => b.checked);
      if (selected.length > 2) {
        alert("Only 2 toppings allowed.");
        box.checked = false;
      }
      updateTotal();
    });
  });

  // ------------------------------
  // Enable / disable Original add-ons
  // ------------------------------
  function enableOriginalAddons(enabled) {
    tofAddons.forEach(a => (a.disabled = !enabled));
    tofAddonQtyInputs.forEach(q => (q.disabled = !enabled));
  }

  enableOriginalAddons(false);

  if (tofOriginal) {
    tofOriginal.addEventListener('change', () => {
      const on = tofOriginal.checked;
      enableOriginalAddons(on);

      if (!on) {
        tofAddons.forEach(a => (a.checked = false));
        tofAddonQtyInputs.forEach(q => (q.value = 1));
      }
      updateTotal();
    });
  }

  // If change add-ons / qty => refresh total
  tofAddons.forEach(a => a.addEventListener('change', updateTotal));
  tofAddonQtyInputs.forEach(q => q.addEventListener('input', updateTotal));

  // ------------------------------
  // Compute order and prices
  // ------------------------------
  function computeOrder() {
    let total = 0;
    let hasItem = false;

    let dessertQty = 0;
    let dessertList = [];

    let coconutQty = 0;

    let lines = [];

    checkboxes.forEach(cb => {
      if (!cb.checked) return;

      hasItem = true;

      const row = cb.closest("tr");
      const qtyInput = row ? row.querySelector(".item-qty") : null;
      const qty = Math.max(1, Number(qtyInput?.value || 1));

      const name = cb.dataset.name || "";
      const group = cb.dataset.group || "";
      const price = Number(cb.dataset.price || 0);

      // ---- Promo groups ----
      if (group === "dessert") {
        dessertQty += qty;
        dessertList.push(${name} x ${qty});
        return;
      }

      if (group === "coconut") {
        coconutQty += qty;
        return;
      }

      // ---- Normal items ----
      let extra = "";

      // Fruit+2 toppings info
      if (name === "Taufufa (Fruit + 2 toppings)") {
        const fruit = Array.from(fruitRadios).find(r => r.checked)?.value || "-";
        const toppings = Array.from(toppingCheckboxes)
          .filter(t => t.checked)
          .map(t => t.value);

        extra = ` (Fruit: ${fruit}; Toppings: ${toppings.join(", ") || "-"})`;
      }

      // Base price
      const baseSubtotal = price * qty;
      total += baseSubtotal;

      // ---- Taufufa Original add-ons (per cup) ----
      if (name === "Taufufa Original") {
        let addonText = [];
        let addonTotalPerCup = 0;

        tofAddons.forEach(addon => {
          if (addon.disabled) return;     // not enabled
          if (!addon.checked) return;

          const addonName = addon.dataset.name;
          const addonPrice = Number(addon.dataset.price || 0);

          const qtyEl = document.querySelector(.tof-addon-qty[data-name="${addonName}"]);
          const addonQty = Math.max(1, Number(qtyEl?.value || 1));

          addonTotalPerCup += addonPrice * addonQty;
          addonText.push(${addonName} x ${addonQty});
        });

        if (addonText.length) {
          const addonTotal = addonTotalPerCup * qty; // multiply by number of Original cups
          total += addonTotal;
          extra = ` (Add-ons: ${addonText.join(", ")} | +RM ${addonTotal.toFixed(2)})`;
        }
      }

      lines.push(${name}${extra} x ${qty} : RM ${baseSubtotal.toFixed(2)});
    });

    // ---- Pudding promo (3 for 8, else 3 each) ----
    if (dessertQty > 0) {
      const bundles = Math.floor(dessertQty / 3);
      const remainder = dessertQty % 3;
      const puddingPrice = bundles * 8 + remainder * 3;
      total += puddingPrice;

      lines.push(
        Pudding Cups - ${dessertQty} cups [${dessertList.join(", ")}] : RM ${puddingPrice.toFixed(2)}
      );
    }

    // ---- Coconut promo (2 for 8, else 5 each) ----
    if (coconutQty > 0) {
      const bundles = Math.floor(coconutQty / 2);
      const remainder = coconutQty % 2;
      const coconutPrice = bundles * 8 + remainder * 5;
      total += coconutPrice;

      lines.push(Coconut Jelly - ${coconutQty} cups : RM ${coconutPrice.toFixed(2)});
    }

    return { total, hasItem, lines };
  }

  function updateTotal() {
    // é˜²æ­¢ä»»ä½•å°é”™è¯¯å¯¼è‡´æ•´ä¸ªé¡µé¢æ­»æŽ‰
    try {
      const r = computeOrder();
      totalPriceSpan.textContent = r.total.toFixed(2);
      submitBtn.disabled = !r.hasItem;
    } catch (e) {
      console.error("updateTotal failed:", e);
      totalPriceSpan.textContent = "0.00";
      submitBtn.disabled = true;
    }
  }

  // bind events
  checkboxes.forEach(cb => cb.addEventListener("change", updateTotal));
  qtyInputs.forEach(q => q.addEventListener("input", updateTotal));

  updateTotal();

  // ------------------------------
  // Submit Order
  // ------------------------------
  submitBtn.addEventListener("click", () => {
    const r = computeOrder();

    if (!r.hasItem) {
      alert("Please select at least 1 item.");
      return;
    }

    const name = document.getElementById("name").value.trim();
    const whatsapp = document.getElementById("whatsapp").value.trim();
    const kolej = document.getElementById("kolej-block").value.trim();
    const date = document.getElementById("delivery-date").value.trim();
    const timeSlot = document.getElementById("timeSlot").value.trim();
    const remark = document.getElementById("remark").value.trim();

    if (!name || !whatsapp || !kolej || !date || !timeSlot) {
      alert("Please fill in all required customer details.");
      return;
    }

    const confirmMsg =
      Robotic Club Food Fair Order\n\n +
      Name: ${name}\nWhatsApp: ${whatsapp}\nKolej: ${kolej}\nDelivery Date: ${date}\nTime Slot: ${timeSlot}\n\n +
      Order:\n${r.lines.join("\n")}\n\n +
      Total: RM ${r.total.toFixed(2)}\n +
      Remarks: ${remark || "-"}\n\n +
      Press OK to proceed to TNG payment.;

    if (!confirm(confirmMsg)) return;

    // Send to Google Sheet
    try {
      const formData = new URLSearchParams();
      formData.append("name", name);
      formData.append("whatsapp", whatsapp);
      formData.append("kolejBlock", kolej);
      formData.append("deliveryDate", date);
      formData.append("timeSlot", timeSlot);
      formData.append("remark", remark);
      formData.append("total", r.total.toFixed(2));
      formData.append("orderText", r.lines.join("\n"));

      fetch(SHEET_API, { method: "POST", body: formData });
    } catch (err) {
      console.error("Failed to send order:", err);
    }

    // Open TNG page
    window.open("tng-qrcode.html?total=" + r.total.toFixed(2), "_blank");
  });
});
</script>
</body>
</html>
